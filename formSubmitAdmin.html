<!DOCTYPE html>
<html lang="zh-TW">
<head>
      <!-- ******************** 基礎 SEO 設定 ******************** -->
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="description" content="仁愛玉璽報名資訊查看">
      <meta name="author" content="國際房產分析師曾宇正-0972939696">
  <title>預約資料管理後台</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: Arial; padding: 20px; max-width: 1200px; margin: 0 auto; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
    th { background-color: #f2f2f2; }
    .auth-container { margin: 50px auto; width: 300px; text-align: center; }
    input, button { padding: 10px; margin: 5px; width: 100%; }
  </style>
</head>
<body>
  <div id="auth-container" class="auth-container">
    <h2>管理員登入</h2>
    <input type="password" id="admin-password" placeholder="輸入管理密碼">
    <button onclick="login()">登入</button>
  </div>

  <div id="data-container" style="display: none;">
    <h1>預約資料列表</h1>
    <table id="dataTable">
      <thead>
        <tr>
            <th>案名</th>
          <th>姓名</th>
          <th>性別</th>
          <th>電話</th>
          <th>Email</th>
          <th>備註</th>
          <th>提交時間</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    // 初始化 Supabase（使用 service_role key 僅限後台）
    const supabaseAdmin = supabase.createClient(
      'https://curnwqgxvinolwjysekv.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN1cm53cWd4dmlub2x3anlzZWt2Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0Mzc1MTEzOSwiZXhwIjoyMDU5MzI3MTM5fQ.dGDF52kep-ZY0iHrrb_Cc9PTeVXULw7bwvosTkTVzu8' // 重要！不要暴露在前端環境
    );
    

    // 密碼驗證（實際項目應使用 Supabase Auth）
    const ADMIN_PASSWORD = "29390040";

    function login() {
      const password = document.getElementById('admin-password').value;
      if (password === ADMIN_PASSWORD) {
        document.getElementById('auth-container').style.display = 'none';
        document.getElementById('data-container').style.display = 'block';
        loadData();
      } else {
        alert('密碼錯誤');
      }
    }

    async function loadData() {
      const { data, error } = await supabaseAdmin
        .from('signups')
        .select('*')
        .order('created_at', { ascending: false });

      if (error) {
        console.error('載入失敗:', error);
        alert('無法載入資料');
        return;
      }

      const tbody = document.querySelector('#dataTable tbody');
      tbody.innerHTML = data.map(item => `
        <tr>
            <td>${item.project}</td>
          <td>${item.name}</td>
          <td>${item.gender}</td>
          <td>${item.phone}</td>
          <td>${item.email}</td>
          <td>${item.message || '-'}</td>
          <td>${new Date(item.created_at).toLocaleString()}</td>
        </tr>
      `).join('');
    }
  </script>
</body>
</html>